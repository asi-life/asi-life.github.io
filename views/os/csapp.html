<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>【操作系统】 深入理解操作系统笔记 | 差不多的贝壳</title>
    <meta name="generator" content="VuePress 1.7.1">
    <link rel="icon" href="/logo.ico">
    <script language="javascript" type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/js/MouseClickEffect.js"></script>
    <script language="javascript" type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=default"></script>
    <meta name="description" content="【操作系统】 深入理解操作系统笔记">
    <meta name="深入理解操作系统笔记" content="深入理解操作系统笔记">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    
    <link rel="preload" href="/assets/css/0.styles.98698290.css" as="style"><link rel="preload" href="/assets/js/app.e5db9849.js" as="script"><link rel="preload" href="/assets/js/3.ed8c06e7.js" as="script"><link rel="preload" href="/assets/js/1.9e75a2be.js" as="script"><link rel="preload" href="/assets/js/29.0e91ba17.js" as="script"><link rel="prefetch" href="/assets/js/10.dcd742d7.js"><link rel="prefetch" href="/assets/js/11.9e8caa91.js"><link rel="prefetch" href="/assets/js/12.5acc7bfe.js"><link rel="prefetch" href="/assets/js/13.64c27640.js"><link rel="prefetch" href="/assets/js/14.d7c2c7ad.js"><link rel="prefetch" href="/assets/js/15.57c5ac2c.js"><link rel="prefetch" href="/assets/js/16.378ffe0f.js"><link rel="prefetch" href="/assets/js/17.89b3d75d.js"><link rel="prefetch" href="/assets/js/18.08a58208.js"><link rel="prefetch" href="/assets/js/19.0b8c12f8.js"><link rel="prefetch" href="/assets/js/20.438d1ec1.js"><link rel="prefetch" href="/assets/js/21.360c7dad.js"><link rel="prefetch" href="/assets/js/22.886d59ab.js"><link rel="prefetch" href="/assets/js/23.36693c07.js"><link rel="prefetch" href="/assets/js/24.c203effa.js"><link rel="prefetch" href="/assets/js/25.d0b49f35.js"><link rel="prefetch" href="/assets/js/26.0bd0b751.js"><link rel="prefetch" href="/assets/js/27.1ead41b5.js"><link rel="prefetch" href="/assets/js/28.8c71231e.js"><link rel="prefetch" href="/assets/js/30.ba3f7ee4.js"><link rel="prefetch" href="/assets/js/31.a5aa6b4a.js"><link rel="prefetch" href="/assets/js/32.0180d8a3.js"><link rel="prefetch" href="/assets/js/33.1689da57.js"><link rel="prefetch" href="/assets/js/34.40068ec9.js"><link rel="prefetch" href="/assets/js/35.d45fa313.js"><link rel="prefetch" href="/assets/js/36.116b7de3.js"><link rel="prefetch" href="/assets/js/37.9156b580.js"><link rel="prefetch" href="/assets/js/38.64581f9c.js"><link rel="prefetch" href="/assets/js/39.e9338707.js"><link rel="prefetch" href="/assets/js/4.c3d42842.js"><link rel="prefetch" href="/assets/js/40.73109616.js"><link rel="prefetch" href="/assets/js/41.1b147abb.js"><link rel="prefetch" href="/assets/js/42.05bdc65e.js"><link rel="prefetch" href="/assets/js/43.8854147b.js"><link rel="prefetch" href="/assets/js/44.170947a8.js"><link rel="prefetch" href="/assets/js/45.47f74164.js"><link rel="prefetch" href="/assets/js/5.d57156ee.js"><link rel="prefetch" href="/assets/js/6.bd4ca3cb.js"><link rel="prefetch" href="/assets/js/7.fadd64b2.js"><link rel="prefetch" href="/assets/js/8.edf6ba42.js"><link rel="prefetch" href="/assets/js/9.9cbd478f.js">
    <link rel="stylesheet" href="/assets/css/0.styles.98698290.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container no-sidebar" data-v-2d5f533b><div data-v-2d5f533b><div id="loader-wrapper" class="loading-wrapper" data-v-d48f4d20 data-v-2d5f533b data-v-2d5f533b><div class="loader-main" data-v-d48f4d20><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div><div data-v-d48f4d20></div></div> <!----> <!----></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-64685f0e data-v-2d5f533b data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>差不多的贝壳</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>差不多的贝壳</span>
            
          <span data-v-64685f0e>2021 - </span>
          2024
        </a></span></div></div> <div class="hide" data-v-2d5f533b><header class="navbar" data-v-2d5f533b><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="差不多的贝壳" class="logo"> <span class="site-name">差不多的贝壳</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/人生第一次/" class="nav-link"><i class="iconfont undefined"></i>
  人生第一次
</a></li><li class="dropdown-item"><!----> <a href="/categories/书籍/" class="nav-link"><i class="iconfont undefined"></i>
  书籍
</a></li><li class="dropdown-item"><!----> <a href="/categories/生活/" class="nav-link"><i class="iconfont undefined"></i>
  生活
</a></li><li class="dropdown-item"><!----> <a href="/categories/电影/" class="nav-link"><i class="iconfont undefined"></i>
  电影
</a></li><li class="dropdown-item"><!----> <a href="/categories/宫崎骏/" class="nav-link"><i class="iconfont undefined"></i>
  宫崎骏
</a></li><li class="dropdown-item"><!----> <a href="/categories/电视剧/" class="nav-link"><i class="iconfont undefined"></i>
  电视剧
</a></li><li class="dropdown-item"><!----> <a href="/categories/日剧/" class="nav-link"><i class="iconfont undefined"></i>
  日剧
</a></li><li class="dropdown-item"><!----> <a href="/categories/生活剧/" class="nav-link"><i class="iconfont undefined"></i>
  生活剧
</a></li><li class="dropdown-item"><!----> <a href="/categories/袁隆平/" class="nav-link"><i class="iconfont undefined"></i>
  袁隆平
</a></li><li class="dropdown-item"><!----> <a href="/categories/国士无双/" class="nav-link"><i class="iconfont undefined"></i>
  国士无双
</a></li><li class="dropdown-item"><!----> <a href="/categories/学习/" class="nav-link"><i class="iconfont undefined"></i>
  学习
</a></li><li class="dropdown-item"><!----> <a href="/categories/操作系统/" class="nav-link"><i class="iconfont undefined"></i>
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/categories/动漫/" class="nav-link"><i class="iconfont undefined"></i>
  动漫
</a></li><li class="dropdown-item"><!----> <a href="/categories/故事/" class="nav-link"><i class="iconfont undefined"></i>
  故事
</a></li><li class="dropdown-item"><!----> <a href="/categories/婚姻/" class="nav-link"><i class="iconfont undefined"></i>
  婚姻
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试题/" class="nav-link"><i class="iconfont undefined"></i>
  面试题
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/中间件/" class="nav-link"><i class="iconfont undefined"></i>
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/categories/消息队列/" class="nav-link"><i class="iconfont undefined"></i>
  消息队列
</a></li><li class="dropdown-item"><!----> <a href="/categories/Photoshop/" class="nav-link"><i class="iconfont undefined"></i>
  Photoshop
</a></li><li class="dropdown-item"><!----> <a href="/categories/网络编程/" class="nav-link"><i class="iconfont undefined"></i>
  网络编程
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/框架/" class="nav-link"><i class="iconfont undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/categories/redis/" class="nav-link"><i class="iconfont undefined"></i>
  redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/近日总结/" class="nav-link"><i class="iconfont undefined"></i>
  近日总结
</a></li><li class="dropdown-item"><!----> <a href="/categories/Zookeeper/" class="nav-link"><i class="iconfont undefined"></i>
  Zookeeper
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/message-board.html" class="nav-link"><i class="iconfont reco-suggestion"></i>
  留言板
</a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-2d5f533b></div> <aside class="sidebar" data-v-2d5f533b><div class="personal-info-wrapper" data-v-ca798c94 data-v-2d5f533b><img src="/logo.jpg" alt="author-avatar" class="personal-img" data-v-ca798c94> <h3 class="name" data-v-ca798c94>
    差不多的贝壳
  </h3> <div class="num" data-v-ca798c94><div data-v-ca798c94><h3 data-v-ca798c94>34</h3> <h6 data-v-ca798c94>文章</h6></div> <div data-v-ca798c94><h3 data-v-ca798c94>38</h3> <h6 data-v-ca798c94>标签</h6></div></div> <hr data-v-ca798c94></div> <nav class="nav-links"><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/人生第一次/" class="nav-link"><i class="iconfont undefined"></i>
  人生第一次
</a></li><li class="dropdown-item"><!----> <a href="/categories/书籍/" class="nav-link"><i class="iconfont undefined"></i>
  书籍
</a></li><li class="dropdown-item"><!----> <a href="/categories/生活/" class="nav-link"><i class="iconfont undefined"></i>
  生活
</a></li><li class="dropdown-item"><!----> <a href="/categories/电影/" class="nav-link"><i class="iconfont undefined"></i>
  电影
</a></li><li class="dropdown-item"><!----> <a href="/categories/宫崎骏/" class="nav-link"><i class="iconfont undefined"></i>
  宫崎骏
</a></li><li class="dropdown-item"><!----> <a href="/categories/电视剧/" class="nav-link"><i class="iconfont undefined"></i>
  电视剧
</a></li><li class="dropdown-item"><!----> <a href="/categories/日剧/" class="nav-link"><i class="iconfont undefined"></i>
  日剧
</a></li><li class="dropdown-item"><!----> <a href="/categories/生活剧/" class="nav-link"><i class="iconfont undefined"></i>
  生活剧
</a></li><li class="dropdown-item"><!----> <a href="/categories/袁隆平/" class="nav-link"><i class="iconfont undefined"></i>
  袁隆平
</a></li><li class="dropdown-item"><!----> <a href="/categories/国士无双/" class="nav-link"><i class="iconfont undefined"></i>
  国士无双
</a></li><li class="dropdown-item"><!----> <a href="/categories/学习/" class="nav-link"><i class="iconfont undefined"></i>
  学习
</a></li><li class="dropdown-item"><!----> <a href="/categories/操作系统/" class="nav-link"><i class="iconfont undefined"></i>
  操作系统
</a></li><li class="dropdown-item"><!----> <a href="/categories/动漫/" class="nav-link"><i class="iconfont undefined"></i>
  动漫
</a></li><li class="dropdown-item"><!----> <a href="/categories/故事/" class="nav-link"><i class="iconfont undefined"></i>
  故事
</a></li><li class="dropdown-item"><!----> <a href="/categories/婚姻/" class="nav-link"><i class="iconfont undefined"></i>
  婚姻
</a></li><li class="dropdown-item"><!----> <a href="/categories/java/" class="nav-link"><i class="iconfont undefined"></i>
  java
</a></li><li class="dropdown-item"><!----> <a href="/categories/面试题/" class="nav-link"><i class="iconfont undefined"></i>
  面试题
</a></li><li class="dropdown-item"><!----> <a href="/categories/Java/" class="nav-link"><i class="iconfont undefined"></i>
  Java
</a></li><li class="dropdown-item"><!----> <a href="/categories/中间件/" class="nav-link"><i class="iconfont undefined"></i>
  中间件
</a></li><li class="dropdown-item"><!----> <a href="/categories/消息队列/" class="nav-link"><i class="iconfont undefined"></i>
  消息队列
</a></li><li class="dropdown-item"><!----> <a href="/categories/Photoshop/" class="nav-link"><i class="iconfont undefined"></i>
  Photoshop
</a></li><li class="dropdown-item"><!----> <a href="/categories/网络编程/" class="nav-link"><i class="iconfont undefined"></i>
  网络编程
</a></li><li class="dropdown-item"><!----> <a href="/categories/数据库/" class="nav-link"><i class="iconfont undefined"></i>
  数据库
</a></li><li class="dropdown-item"><!----> <a href="/categories/框架/" class="nav-link"><i class="iconfont undefined"></i>
  框架
</a></li><li class="dropdown-item"><!----> <a href="/categories/redis/" class="nav-link"><i class="iconfont undefined"></i>
  redis
</a></li><li class="dropdown-item"><!----> <a href="/categories/近日总结/" class="nav-link"><i class="iconfont undefined"></i>
  近日总结
</a></li><li class="dropdown-item"><!----> <a href="/categories/Zookeeper/" class="nav-link"><i class="iconfont undefined"></i>
  Zookeeper
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      关于
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/views/message-board.html" class="nav-link"><i class="iconfont reco-suggestion"></i>
  留言板
</a></li></ul></div></div> <!----></nav> <!----> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-64685f0e data-v-2d5f533b><h3 class="title" style="display:none;" data-v-64685f0e data-v-64685f0e>【操作系统】 深入理解操作系统笔记</h3> <!----> <label id="box" class="inputBox" style="display:none;" data-v-64685f0e data-v-64685f0e><input type="password" value="" data-v-64685f0e> <span data-v-64685f0e>Konck! Knock!</span> <button data-v-64685f0e>OK</button></label> <div class="footer" style="display:none;" data-v-64685f0e data-v-64685f0e><span data-v-64685f0e><i class="iconfont reco-theme" data-v-64685f0e></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-64685f0e>vuePress-theme-reco</a></span> <span data-v-64685f0e><i class="iconfont reco-copyright" data-v-64685f0e></i> <a data-v-64685f0e><span data-v-64685f0e>差不多的贝壳</span>
            
          <span data-v-64685f0e>2021 - </span>
          2024
        </a></span></div></div> <div data-v-2d5f533b><main class="page"><div class="page-title" style="display:none;"><h1 class="title">【操作系统】 深入理解操作系统笔记</h1> <div data-v-3b7f5bdf><i class="iconfont reco-account" data-v-3b7f5bdf><span data-v-3b7f5bdf>差不多的贝壳</span></i> <i class="iconfont reco-date" data-v-3b7f5bdf><span data-v-3b7f5bdf>2021-04-23</span></i> <i class="iconfont reco-eye" data-v-3b7f5bdf><span id="/views/os/csapp.html" data-flag-title="Your Article Title" class="leancloud-visitors" data-v-3b7f5bdf><a class="leancloud-visitors-count" style="font-size:.9rem;font-weight:normal;color:#999;"></a></span></i> <i class="iconfont reco-tag tags" data-v-3b7f5bdf><span class="tag-item" data-v-3b7f5bdf>操作系统</span></i></div></div> <div class="theme-reco-content content__default" style="display:none;"><h2 id="目的"><a href="#目的" class="header-anchor">#</a> 目的</h2> <p>作为一名计算机工程师，经常编写代码，但是常常会出现很多系统方面的问题。却不知道该如何去解决。也不了解自己的代码于底层操作系统的关系，自己编写的代码如何通过操作系统去执行然后返回我们需要的结果。因此系统通过&lt;&lt;深入理解操作系统&gt;&gt;一书有个初步的认识。对于自己编写更优质的代码和解决一些代码的问题时有更好的处理方式。</p> <h2 id="目录介绍"><a href="#目录介绍" class="header-anchor">#</a> 目录介绍</h2> <p>一. 计算机系统漫游：通过研究&quot;hello，world&quot;这个简单程序的生命周期，介绍计算机系统的主要概念和主题。</p> <p>二. 信息的表示和处理：讲述计算机的算术运算，重点描述了会对程序员有影响的无符号数和数的补码表示的特性。</p> <p>三. 程序的机器级表示：如何阅读C编译器生成的x86-64机器代码</p> <p>四. 处理器体系结构：讲述基本的组合和时序逻辑元素，并展示这些元素如何在数据通路中组合到一起，来执行x86-64指令集的一个称为&quot;Y86-64&quot;的简化子集。</p> <p>五. 优化程序性能：介绍提高代码性能的技术。</p> <p>六. 存储器层次结构：对应用程序员来说，存储器系统是计算器系统中最直接可见的部分之一。</p> <p>七. 链接：主要介绍静态和动态链接。</p> <p>八. 异常控制流：介绍异常控制流的一般概念。</p> <p>九. 虚拟内存：讲述虚拟内存系统的工作原理以及特性。</p> <p>十. 系统级I/O：讲述Unix I/O的基本概念。</p> <p>十一. 网络编程：将整个流程中讲的知识点进行串联。</p> <p>十二. 并发编程.</p> <h2 id="第一章-计算机系统漫游"><a href="#第一章-计算机系统漫游" class="header-anchor">#</a> 第一章 计算机系统漫游</h2> <p>从整体上大致过一下操作系统，初步了解什么是计算机系统。</p> <h3 id="计算机系统"><a href="#计算机系统" class="header-anchor">#</a> 计算机系统</h3> <p>由硬件和系统软件组成，共同工作来运行应用程序。</p> <h3 id="程序运行流程"><a href="#程序运行流程" class="header-anchor">#</a> 程序运行流程</h3> <p>以下讲介绍计算机操作系统如何来运行c语言的hello.c文件的。</p> <div class="language-cpp extra-class"><pre class="language-cpp"><code><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">&lt;stdio.h&gt;</span></span>
<span class="token keyword">int</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token function">printf</span><span class="token punctuation">(</span><span class="token string">&quot;hello, world\n&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
	<span class="token keyword">return</span> <span class="token number">0</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>上述hello.c源文件实际是一个由值0和1组成的位(比特bit)序列，8个位一组称为字节。通过ASCII标准来表示文本字符，因而hello.c也被成为文本文件。</p> <p>而操作系统识别的为0或1组成的二进制文件。所以我们需要了解一个文本文件转换成二进制文件的过程。</p> <p>我们常在Unix系统上，使用如下命令执行。</p> <div class="language-shell extra-class"><pre class="language-shell"><code>gcc -o hello hello.c
</code></pre></div><p>其含义是，通过gcc编译器读取源程序文件hello.c,并把它翻译成一个这执行的目标文件hello。</p> <p>这个过程分为四个阶段，如下图所示：</p> <p><img src="https://github.com/asi-life/asiLifePic/blob/master/os/%E7%BC%96%E8%AF%91%E7%B3%BB%E7%BB%9F.png?raw=true" alt="编译系统"></p> <ul><li><p>预处理阶段。根据#号字符开头的命令，修改源程序。例如hello.c中的第一行的#include&lt;stdio.h&gt;告诉预处理器读取系统文件stdio.h的内容，并把它直接插入程序文本中。得到另一个C程序，是以.i作为文件扩展名。</p></li> <li><p>编译阶段。编译器将文本文件.i翻译成文本文件hello.s。包含汇编语言。</p></li> <li><p>汇编阶段。汇编器将hello.s翻译成机器语言指令。打包成一种叫做可重定位目标程序的个数，保存在hello.o中。此时为一个二进制文件。</p></li> <li><p>链接阶段。将多个.o文件合并成一个hello文件，可执行文件，并加载到内存中。由系统调用。</p></li></ul> <p>此时生成了一个hello的可执行文件，使用如下命令即可进行执行。</p> <div class="language- extra-class"><pre class="language-text"><code>./hello

输出:
hello, world

</code></pre></div><p>而此时只是相当简单的命令，但是在操作系统内部其实发生了很多事情。</p> <h3 id="系统的硬件组成"><a href="#系统的硬件组成" class="header-anchor">#</a> 系统的硬件组成</h3> <p>在此之前，我们需要了解下系统的硬件组成，才能更好的理解其运行流程。</p> <p><img src="https://github.com/asi-life/asiLifePic/blob/master/os/%E7%B3%BB%E7%BB%9F%E7%9A%84%E7%A1%AC%E4%BB%B6%E7%BB%84%E6%88%90.png?raw=true" alt="硬件组成"></p> <ol><li><p>总线：贯穿整个系统的是一组电子管道。携带信息字节并负责在各个部件间传递。一般传递字节块，即字，而字长在各个操作系统中不是定值。</p></li> <li><p>I/O(输入/输出)设备是系统与外部世界的联系通道，输入设备(键盘，鼠标)，输出设备(显示器)，存储设备(磁盘)。</p></li> <li><p>主存
主存是一个临时的存储设备，在处理器执行程序时，用来存放程序和程序处理的数据。物理上来说，是一组动态随机存储存储器(DRAM)芯片组成，逻辑上来说，是一个线性的字节数组，每个字节都有其唯一的地址(数组索引)。</p></li> <li><p>处理器
中央处理单元(CPU),简称处理器，解释存储在主存中指令的引擎。处理器的核心是一个大小为一个字的存储设备(寄存器)，称为程序计数器。</p></li></ol> <p>而在从键盘上输入./hello的时候，其硬件上的执行流程如下：</p> <p><img src="https://github.com/asi-life/asiLifePic/blob/master/os/%E4%BB%8E%E9%94%AE%E7%9B%98%E4%B8%8A%E8%AF%BB%E5%8F%96hello%E5%91%BD%E4%BB%A4.png?raw=true" alt="从键盘上读取hello命令"></p> <p>通过USB控制器获取用户输入，然后通过总线接口将命令读入寄存器，再将其放到内存中。</p> <p>后续通过一系列指令加载可执行的hello文件，将文件中的代码和数据从磁盘复制到主存中。</p> <p><img src="https://github.com/asi-life/asiLifePic/blob/master/os/%E4%BB%8E%E7%A3%81%E7%9B%98%E5%8A%A0%E8%BD%BD%E5%8F%AF%E6%89%A7%E8%A1%8C%E6%96%87%E4%BB%B6%E5%88%B0%E4%B8%BB%E5%AD%98.png?raw=true" alt="从磁盘加载可执行文件到主存"></p> <p>加载完成后，处理器就会执行hello程序。将结果显示传递给寄存器，然后从寄存器复制到显示屏上进行输出。</p> <p><img src="https://github.com/asi-life/asiLifePic/blob/master/os/%E5%B0%86%E8%BE%93%E5%87%BA%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%BB%8E%E5%AD%98%E5%82%A8%E5%99%A8%E5%86%99%E5%88%B0%E6%98%BE%E7%A4%BA%E5%99%A8.png?raw=true" alt="将输出字符串从存储器写到显示器"></p> <p>以上就是一个文件运行时操作系统的主要流程。</p> <ul><li>高速缓存</li></ul> <p>我们发现在操作系统处理过程中，花费了大量时间讲一个信息从一个地方复制到另一个地方。</p> <p>而根据机械的原理，较大的存储设备要比较小的存储设备运行的慢，而快速设备的造价远高于同类型的低速设备。</p> <p>寄存器文件只能存储几百字节的信息，而主存里可存放几十亿字节。处理器从寄存器文件中读取数据的速度比从主存中读取几乎要快100倍。</p> <p>因为针对处理器与主存之间的差异，采用更小，更快的存储设备，即高速缓存存储器，作为暂时的存储区域，来存储近期可能会用到的信息，减少到主存的的读取次数。</p> <p>在处理器中和较大较慢的设备(或程序)之间插入一个更小更快的存储设备(或程序)的思想已经相对普遍，实际应用中也使用了较多类似方法。</p> <p><img src="https://github.com/asi-life/asiLifePic/blob/master/os/%E4%B8%80%E4%B8%AA%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84%E7%9A%84%E7%A4%BA%E4%BE%8B.png?raw=true" alt="一个存储器层次结构的示例"></p> <h3 id="操作系统与硬件"><a href="#操作系统与硬件" class="header-anchor">#</a> 操作系统与硬件</h3> <p>通过上面读取例子，我们可看到，hello程序并没有直接访问键盘，显示器，磁盘，主存。这一切可实现的基础就是由操作系统提供的服务。因此操作系统时应用程序和硬件之间的一层软件。</p> <p>操作系统的两个基本功能：1. 防止硬件被失控的应用程序滥用。2. 向应用程序提供简单一致的机制来控制设备。</p> <p>而操作系统通过进程，虚拟内存和文件来实现这两个功能。</p> <p><img src="https://github.com/asi-life/asiLifePic/blob/master/os/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F%E6%8F%90%E4%BE%9B%E7%9A%84%E6%8A%BD%E8%B1%A1%E8%A1%A8%E7%A4%BA.png?raw=true" alt="操作系统提供的抽象表示"></p> <ul><li>进程</li></ul> <p>上述提到的可执行文件hello，就是一个进程。根据字面意思理解则为一个正在运行的程序。对于单核CPU来说，同一时间点，只能有一个进程是运行状态的。</p> <ul><li>线程</li></ul> <p>进程中有多个线程。</p> <ul><li>虚拟内存</li></ul> <p>每个进程看到的内存都是一致的，成为虚拟地址空间。</p> <p><img src="https://github.com/asi-life/asiLifePic/blob/master/os/%E8%BF%9B%E7%A8%8B%E7%9A%84%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4.png?raw=true" alt="进程的虚拟地址空间"></p> <div class="language- extra-class"><pre><code>- 程序代码和数据。代码是从同一个固定地址开始。

- 堆。代码和数据区后紧随着的是运行时堆。

- 共享库。存放标准库和数学库这种共享库的代码和数据的区域

- 栈。用户虚拟地址空间顶部为用户栈，编译器用它来实现函数调用。

- 内核虚拟内存。地址空间顶部的区域为内核保留使用。
</code></pre></div><ul><li>文件</li></ul> <p>字节序列。</p> <h3 id="系统之间的网络通信"><a href="#系统之间的网络通信" class="header-anchor">#</a> 系统之间的网络通信</h3> <p>而为了能让系统之间可以进行通信。出现了网络适配器。</p> <p><img src="https://github.com/asi-life/asiLifePic/blob/master/os/%E7%BD%91%E7%BB%9C%E4%B9%9F%E6%98%AF%E4%B8%80%E7%A7%8DIO%E8%AE%BE%E5%A4%87.png?raw=true" alt="网络适配器"></p> <h3 id="介绍系统中的部分概念"><a href="#介绍系统中的部分概念" class="header-anchor">#</a> 介绍系统中的部分概念</h3> <ul><li>Amdahl定律</li></ul> <p><img src="https://github.com/asi-life/asiLifePic/blob/master/os/amdahl%E5%AE%9A%E5%BE%8B.png?raw=true" alt="Amdahl定律"></p> <ul><li>并发和并行</li></ul> <p>并发：指一个同时具有多个活动的系统。也是指两个或多个程序再同一时间间隔内发生。</p> <p>并行：指用并发来使一个系统运行得更快。同一个时间点有两个或多个程序运行。</p> <h2 id="第二章-信息的表示和处理"><a href="#第二章-信息的表示和处理" class="header-anchor">#</a> 第二章 信息的表示和处理</h2> <h3 id="信息存储"><a href="#信息存储" class="header-anchor">#</a> 信息存储</h3> <p>计算机中，使用块作为最小的可寻址的内存单位，而不是访问内存中的单独的位，一个块为是8个位组成。即从二进制的 0000 0000 - 1111 1111. 即表示 0 - 255.</p> <p>机器级程序将内存是为一个非常大的字节数组，称为虚拟内存。内存中的每个字节都由一个唯一的数字来标识，称为它的地址。所有可能地址的集合就称为虚拟地址空间。</p> <h4 id="十六进表示法"><a href="#十六进表示法" class="header-anchor">#</a> 十六进表示法</h4> <p>二进制与十进制的转化相对来说比较麻烦。依次通常使用十六进制表示。以0x或0X开头的数字常量被认为是十六进制的值。因为4个位就能表示一个十六进制。</p> <p>一个二次幂的数转化成十六进制比较快的方法： 当x = 2 ^ n 次方时，即对应1后跟了n个零。而n 可以表示成 i + j * 4.  0 &lt;= i &lt;= 3. 表示 以 1(i = 0), 2(i = 1), 4(i = 2), 8(i = 3) 开头的后面跟了 j 个零的16进制。 如： 2048 = 2 ^ 11次方。n为11. 11 = 3 + 4 * 2。所以其十六进制为：0x 800。</p> <h4 id="字数据的大小"><a href="#字数据的大小" class="header-anchor">#</a> 字数据的大小</h4> <p>每台计算机都有一个字长，表示指针数据的大小。也就是我们常说的32位计算机和64位计算机。这决定了虚拟地址空间的最大大小。对于一个字长位w位的机器而言，虚拟地址的范围为0 - (2 ^ w - 1)，即程序最多访问2 ^ w个<font color="red">字节</font>。</p> <p>一般64位的计算机兼容32位计算机的程序。</p> <p>以下位c语言常用类型所占字节。</p> <table><thead><tr><th style="text-align:center;">有符号</th> <th style="text-align:center;">无符号</th> <th style="text-align:center;">32位</th> <th style="text-align:center;">64位</th></tr></thead> <tbody><tr><td style="text-align:center;">[signed] char</td> <td style="text-align:center;">unsigned char</td> <td style="text-align:center;">1</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">short</td> <td style="text-align:center;">unsigned short</td> <td style="text-align:center;">2</td> <td style="text-align:center;">2</td></tr> <tr><td style="text-align:center;">int</td> <td style="text-align:center;">unsigned</td> <td style="text-align:center;">4</td> <td style="text-align:center;">4</td></tr> <tr><td style="text-align:center;">long</td> <td style="text-align:center;">unsigned</td> <td style="text-align:center;">4</td> <td style="text-align:center;">8</td></tr> <tr><td style="text-align:center;">int32_t</td> <td style="text-align:center;">uint32_t</td> <td style="text-align:center;">4</td> <td style="text-align:center;">4</td></tr> <tr><td style="text-align:center;">int64_t</td> <td style="text-align:center;">uint64_t</td> <td style="text-align:center;">8</td> <td style="text-align:center;">8</td></tr> <tr><td style="text-align:center;">char *</td> <td style="text-align:center;"></td> <td style="text-align:center;">4</td> <td style="text-align:center;">8</td></tr> <tr><td style="text-align:center;">float</td> <td style="text-align:center;"></td> <td style="text-align:center;">4</td> <td style="text-align:center;">4</td></tr> <tr><td style="text-align:center;">double</td> <td style="text-align:center;"></td> <td style="text-align:center;">8</td> <td style="text-align:center;">8</td></tr></tbody></table> <p>java基础类型所占字节</p> <table><thead><tr><th style="text-align:center;">有符号</th> <th style="text-align:center;">32位</th> <th style="text-align:center;">64位</th></tr></thead> <tbody><tr><td style="text-align:center;">byte</td> <td style="text-align:center;">8</td> <td style="text-align:center;">8</td></tr> <tr><td style="text-align:center;">short</td> <td style="text-align:center;">16</td> <td style="text-align:center;">16</td></tr> <tr><td style="text-align:center;">int</td> <td style="text-align:center;">32</td> <td style="text-align:center;">32</td></tr> <tr><td style="text-align:center;">long</td> <td style="text-align:center;">64</td> <td style="text-align:center;">64</td></tr> <tr><td style="text-align:center;">float</td> <td style="text-align:center;">32</td> <td style="text-align:center;">32</td></tr> <tr><td style="text-align:center;">double</td> <td style="text-align:center;">64</td> <td style="text-align:center;">64</td></tr> <tr><td style="text-align:center;">char</td> <td style="text-align:center;">16</td> <td style="text-align:center;">16</td></tr> <tr><td style="text-align:center;">boolean</td> <td style="text-align:center;">1</td> <td style="text-align:center;">1</td></tr></tbody></table> <h4 id="寻址和字节顺序"><a href="#寻址和字节顺序" class="header-anchor">#</a> 寻址和字节顺序</h4> <p>语言中的数据存储都有一个地址空间。c中常用查询地址使用&amp;x。对于顺序存储，则只需要直到其最小地址即可。</p> <p>而字节的存放和读取顺序一般有两种。</p> <p>例如： 0x 01234567，每个地址存储8位数据。</p> <p>对于我们而言 01 即为最高位。将01存放到最小的地址上则为 大端法。将最低位67存放在最小的地址上则为小端法。</p> <p>大端法：从最高有效位到最低有效位的存储方法。</p> <p>小端法：从最低有效位到最高有效位的存储方法。</p> <h4 id="字符串和布尔类型"><a href="#字符串和布尔类型" class="header-anchor">#</a> 字符串和布尔类型</h4> <p>字符串表示需要一个结束标记，常为0x00。</p> <p>boolean / bool 只有一位，要么为1 要么为0</p> <h4 id="位运算"><a href="#位运算" class="header-anchor">#</a> 位运算</h4> <div class="language- extra-class"><pre class="language-text"><code>&lt;&lt;   左移
&gt;&gt;   右移
&gt;&gt;&gt;  无符号右移
&amp;    位与
|    位或
~    位非
^    位异或   a ^ a = 0;
</code></pre></div><p>位运算优先级低于 加减法。</p> <p>使用场景：</p> <p>判断奇偶数：  x &amp; 1 == 0</p> <p>交换两者的值：  a ^= b;  b ^= a; a ^= b;</p> <p>取余： hashmap中hash映射的作用。</p> <h3 id="ieee浮点表示"><a href="#ieee浮点表示" class="header-anchor">#</a> IEEE浮点表示</h3> <p>V = (-1)^s * M * 2 ^ E的形式来表示一个数：</p> <ul><li><p>符号(sign) s决定这个数是负数(s = 1) 还是整数(s = 0),而对于数值0的符号位解释作为特殊情况处理。</p></li> <li><p>尾数(significand) M是一个二进制小数</p></li> <li><p>阶码 E的作用是对浮点数加权，这个权重是2的E次幂。</p></li></ul> <p>将浮点数的位表示划分为三个字段：s, exp, frac。</p> <p>对于float单精度的类型来说32位，s为1位，exp为8位，frac为23位。</p> <p>对于double双精度的类型来说64位，s为1位，exp为11位，frac为52位。</p> <p>且exp组合起来可以编码E，frac组合起来编码M，frac为小数计算。</p> <p>规则化的值：exp的位不全0，也不全为1</p> <p>不规则化的值：exp的位全为0或全为1</p> <p>无穷大：exp全为1，且frac的值全为0</p> <p>NaN：exp全为1，且frac的值不为0.</p> <p>偏置位：表示exp的位数的最大值，2^k - 1，</p> <p>规则化情况下：E = exp的值 - 偏置位， M = 1 + frac的值。</p> <p>非规则化情况下：E = 1 - 偏置位，M = frac</p> <h3 id="c语言中的浮点数"><a href="#c语言中的浮点数" class="header-anchor">#</a> C语言中的浮点数</h3> <p>从int转化为float，数字不会溢出，但可能舍入。</p> <p>从int或float转为double，没有问题。</p> <p>从double转为float可能溢出，可能舍入。</p> <p>float或double转为int，会向0舍入。</p> <h2 id="第三章-程序的机器级表示"><a href="#第三章-程序的机器级表示" class="header-anchor">#</a> 第三章 程序的机器级表示</h2> <h3 id="机器级代码"><a href="#机器级代码" class="header-anchor">#</a> 机器级代码</h3> <p>计算机系统使用了多种不同形式的抽象，利用更简单的抽象模型来隐藏实现的细节。</p> <p>机器级编程来说，两种抽象尤为重要:</p> <ol><li><p>指令集体系结构或指令集架构(Instruction Set Architecture,ISA)来定义机器级程序的格式和行为，定义了处理器状态，指令的格式，以及每条指令对状态的影响。</p></li> <li><p>机器级程序使用的内存地址是虚拟地址，提供的内存模型看上去是一个非常大的字节数组。</p></li></ol> <p>汇编代码是用可读性更好的文本格式表示。使用命令和一系列的寄存器进行处理。</p> <p>程序计数器(通常称为&quot;PC&quot;,在x86-64中用%rip表示),给出将要执行的下一条指令在内存中的地址。</p> <p>整数寄存器文件包含16个命名的位置，分别存储64位的值。这些寄存器可以存储地址(对应于C语言的指针)或整数数据。有的寄存器被用来记录某些重要的程序状态，而其他寄存器用来保存临时数据，例如过程中的参数和局部变量，以及函数的返回值。</p> <p>条件码寄存器保存着最近执行的算术或逻辑指令的状态信息。它们用来实现控制或数据流中的条件变化，比如说用来实现if和while语句。</p> <p>一组向量寄存器可以存放一个或者多个整数或浮点数。</p> <h3 id="数据格式"><a href="#数据格式" class="header-anchor">#</a> 数据格式</h3> <p>C语言数类型在x86-64中的大小。在64位机器中，指针长8字节。</p> <table><thead><tr><th style="text-align:center;">C声明</th> <th style="text-align:center;">Intel数据类型</th> <th style="text-align:center;">汇编代码后缀</th> <th style="text-align:center;">大小(字节)</th></tr></thead> <tbody><tr><td style="text-align:center;">char</td> <td style="text-align:center;">字节</td> <td style="text-align:center;">b</td> <td style="text-align:center;">1</td></tr> <tr><td style="text-align:center;">short</td> <td style="text-align:center;">字</td> <td style="text-align:center;">w</td> <td style="text-align:center;">2</td></tr> <tr><td style="text-align:center;">int</td> <td style="text-align:center;">双字</td> <td style="text-align:center;">l</td> <td style="text-align:center;">4</td></tr> <tr><td style="text-align:center;">long</td> <td style="text-align:center;">四字</td> <td style="text-align:center;">q</td> <td style="text-align:center;">8</td></tr> <tr><td style="text-align:center;">char *</td> <td style="text-align:center;">四字</td> <td style="text-align:center;">q</td> <td style="text-align:center;">8</td></tr> <tr><td style="text-align:center;">float</td> <td style="text-align:center;">单精度</td> <td style="text-align:center;">s</td> <td style="text-align:center;">4</td></tr> <tr><td style="text-align:center;">double</td> <td style="text-align:center;">双精度</td> <td style="text-align:center;">l</td> <td style="text-align:center;">8</td></tr></tbody></table> <h3 id="访问信息"><a href="#访问信息" class="header-anchor">#</a> 访问信息</h3> <p>一个x86-64的中央处理单元包含一组16个存储64位值的通用目的寄存器。这些这些寄存器用来存储整数数据和指针。</p> <table><thead><tr><th style="text-align:center;">63 - 32</th> <th style="text-align:center;">31 - 16</th> <th style="text-align:center;">15 - 8</th> <th style="text-align:center;">7 - 0</th> <th style="text-align:center;">常用于</th></tr></thead> <tbody><tr><td style="text-align:center;">%rax</td> <td style="text-align:center;">%eax</td> <td style="text-align:center;">%ax</td> <td style="text-align:center;">%al</td> <td style="text-align:center;">返回值</td></tr> <tr><td style="text-align:center;">%rab</td> <td style="text-align:center;">%ebx</td> <td style="text-align:center;">%bx</td> <td style="text-align:center;">%bl</td> <td style="text-align:center;">被调用者保存</td></tr> <tr><td style="text-align:center;">%rcx</td> <td style="text-align:center;">%ecx</td> <td style="text-align:center;">%cx</td> <td style="text-align:center;">%cl</td> <td style="text-align:center;">第4个参数</td></tr> <tr><td style="text-align:center;">%rdx</td> <td style="text-align:center;">%edx</td> <td style="text-align:center;">%dx</td> <td style="text-align:center;">%dl</td> <td style="text-align:center;">第3个参数</td></tr> <tr><td style="text-align:center;">%rsi</td> <td style="text-align:center;">%esi</td> <td style="text-align:center;">%si</td> <td style="text-align:center;">%sil</td> <td style="text-align:center;">第2个参数</td></tr> <tr><td style="text-align:center;">%rdi</td> <td style="text-align:center;">%edi</td> <td style="text-align:center;">%di</td> <td style="text-align:center;">%dil</td> <td style="text-align:center;">第1个参数</td></tr> <tr><td style="text-align:center;">%rbp</td> <td style="text-align:center;">%ebp</td> <td style="text-align:center;">%bp</td> <td style="text-align:center;">%bpl</td> <td style="text-align:center;">被调用者保存</td></tr> <tr><td style="text-align:center;">%rsp</td> <td style="text-align:center;">%esp</td> <td style="text-align:center;">%sp</td> <td style="text-align:center;">%spl</td> <td style="text-align:center;">栈指针</td></tr> <tr><td style="text-align:center;">%r8</td> <td style="text-align:center;">%r8d</td> <td style="text-align:center;">%r8w</td> <td style="text-align:center;">%r8b</td> <td style="text-align:center;">第5个参数</td></tr> <tr><td style="text-align:center;">%r9</td> <td style="text-align:center;">%r9d</td> <td style="text-align:center;">%r9w</td> <td style="text-align:center;">%r9b</td> <td style="text-align:center;">第6个参数</td></tr> <tr><td style="text-align:center;">%r10</td> <td style="text-align:center;">%r10d</td> <td style="text-align:center;">%r10w</td> <td style="text-align:center;">%r10b</td> <td style="text-align:center;">调用者保存</td></tr> <tr><td style="text-align:center;">%r11</td> <td style="text-align:center;">%r11d</td> <td style="text-align:center;">%r11w</td> <td style="text-align:center;">%r11b</td> <td style="text-align:center;">调用者保存</td></tr> <tr><td style="text-align:center;">%r12</td> <td style="text-align:center;">%r12d</td> <td style="text-align:center;">%r12w</td> <td style="text-align:center;">%r12b</td> <td style="text-align:center;">被调用者保存</td></tr> <tr><td style="text-align:center;">%r13</td> <td style="text-align:center;">%r13d</td> <td style="text-align:center;">%r13w</td> <td style="text-align:center;">%r13b</td> <td style="text-align:center;">被调用者保存</td></tr> <tr><td style="text-align:center;">%r14</td> <td style="text-align:center;">%r14d</td> <td style="text-align:center;">%r14w</td> <td style="text-align:center;">%r14b</td> <td style="text-align:center;">被调用者保存</td></tr> <tr><td style="text-align:center;">%r15</td> <td style="text-align:center;">%r15d</td> <td style="text-align:center;">%r15w</td> <td style="text-align:center;">%r15b</td> <td style="text-align:center;">被调用者保存</td></tr></tbody></table> <h3 id="操作数指示符"><a href="#操作数指示符" class="header-anchor">#</a> 操作数指示符</h3> <p>大多数指令有一个或多个操作数，指示出执行一个操作中要使用的源数据值。</p> <p>各种不同的操作数的可能性被分为三种类型。</p> <p>第一种类型是立即数，用来表示常数值。立即数的书写方式是'$'后跟一个用标准C表示法表示的整数。</p> <p>第二种类型是寄存器。表示某个寄存器的内容，用符号ra来表示任意寄存器a，用引用R[ra]来表示它的值。</p> <p>第三种操作数是内存引用。根据计算出来的地址访问某个内存位置。因为将内存看成一个很大的字节数组，我们用符号Mb[Addr]表示对存储在内存种从地址Addr开始的b个字节值的引用。</p> <table><thead><tr><th style="text-align:center;">类型</th> <th style="text-align:center;">格式</th> <th style="text-align:center;">操作数值</th> <th style="text-align:center;">名称</th></tr></thead> <tbody><tr><td style="text-align:center;">立即数</td> <td style="text-align:center;">$Imm</td> <td style="text-align:center;">Imm</td> <td style="text-align:center;">立即数寻址</td></tr> <tr><td style="text-align:center;">寄存器</td> <td style="text-align:center;">r.a (.表示下标)</td> <td style="text-align:center;">R[r.a]</td> <td style="text-align:center;">寄存器寻址</td></tr> <tr><td style="text-align:center;">存储器</td> <td style="text-align:center;">Imm</td> <td style="text-align:center;">M[Imm]</td> <td style="text-align:center;">绝对寻址</td></tr> <tr><td style="text-align:center;">存储器</td> <td style="text-align:center;">(r.a)</td> <td style="text-align:center;">M[R[r.a]]</td> <td style="text-align:center;">间接寻址</td></tr> <tr><td style="text-align:center;">存储器</td> <td style="text-align:center;">Imm(r.b)</td> <td style="text-align:center;">M[Imm+R[r.b]]</td> <td style="text-align:center;">(基址+偏移量)寻址</td></tr> <tr><td style="text-align:center;">存储器</td> <td style="text-align:center;">(r.b,r.i)</td> <td style="text-align:center;">M[R[r.b] + R[r.i]]</td> <td style="text-align:center;">变址寻址</td></tr> <tr><td style="text-align:center;">存储器</td> <td style="text-align:center;">Imm(r.b,r.i)</td> <td style="text-align:center;">M[Imm + R[r.b] + R[r.i]]</td> <td style="text-align:center;">变址寻址</td></tr> <tr><td style="text-align:center;">存储器</td> <td style="text-align:center;">(,r.i,s)</td> <td style="text-align:center;">M[R[r.i]*s]</td> <td style="text-align:center;">比例变址寻址</td></tr> <tr><td style="text-align:center;">存储器</td> <td style="text-align:center;">Imm(,r.i,s)</td> <td style="text-align:center;">M[Imm + R[r.i]*s]</td> <td style="text-align:center;">比例变址寻址</td></tr> <tr><td style="text-align:center;">存储器</td> <td style="text-align:center;">(r.b,r.i,s)</td> <td style="text-align:center;">M[R[r.b] + R[r.i] * s]</td> <td style="text-align:center;">比例变址寻址</td></tr> <tr><td style="text-align:center;">存储器</td> <td style="text-align:center;">Imm(r.b,r.i,s)</td> <td style="text-align:center;">M[Imm + R[r.b] + R[r.i] * s]</td> <td style="text-align:center;">比例变址寻址</td></tr></tbody></table> <h3 id="常用指令"><a href="#常用指令" class="header-anchor">#</a> 常用指令</h3> <ol><li>数据传送指令</li></ol> <p>最简单形式的数据传送指令————MOV类，将数据从一个位置复制到另一个位置的指令。MOV类由四条指令组成：</p> <p>movb, movw, movl, movq.</p> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">效果</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">MOV S,D</td> <td style="text-align:center;">D ← S</td> <td style="text-align:center;">传送</td></tr> <tr><td style="text-align:center;">movb</td> <td style="text-align:center;"></td> <td style="text-align:center;">传送字节</td></tr> <tr><td style="text-align:center;">movw</td> <td style="text-align:center;"></td> <td style="text-align:center;">传送字</td></tr> <tr><td style="text-align:center;">movl</td> <td style="text-align:center;"></td> <td style="text-align:center;">传送双字</td></tr> <tr><td style="text-align:center;">movq</td> <td style="text-align:center;"></td> <td style="text-align:center;">传送四字</td></tr> <tr><td style="text-align:center;">movabsq I, R</td> <td style="text-align:center;">R ← I</td> <td style="text-align:center;">传送绝对的四字</td></tr></tbody></table> <p>另外还有两类数据移动指令：MOVZ, MOVS. 将较小的源值复制到较大的目的时使用。</p> <p>MOVZ：</p> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">效果</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">MOVZ S,R</td> <td style="text-align:center;">R ← 零扩展(S)</td> <td style="text-align:center;">以零扩展进行传送</td></tr> <tr><td style="text-align:center;">movzbw</td> <td style="text-align:center;"></td> <td style="text-align:center;">将做了零扩展的字节传送到字</td></tr> <tr><td style="text-align:center;">movzbl</td> <td style="text-align:center;"></td> <td style="text-align:center;">将做了零扩展的字节传送到双字</td></tr> <tr><td style="text-align:center;">movzwl</td> <td style="text-align:center;"></td> <td style="text-align:center;">将做了零扩展的字传送到双字</td></tr> <tr><td style="text-align:center;">movzbq</td> <td style="text-align:center;"></td> <td style="text-align:center;">将做了零扩展的字节传送到四字</td></tr> <tr><td style="text-align:center;">movzwq</td> <td style="text-align:center;"></td> <td style="text-align:center;">将做了零扩展的字传送到四字</td></tr></tbody></table> <p>MOVS</p> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">效果</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">MOVS S,R</td> <td style="text-align:center;">R ← 符号扩展(S)</td> <td style="text-align:center;">传送符号扩展的字节</td></tr> <tr><td style="text-align:center;">movsbw</td> <td style="text-align:center;"></td> <td style="text-align:center;">将做了符号扩展的字节传送到字</td></tr> <tr><td style="text-align:center;">movsbl</td> <td style="text-align:center;"></td> <td style="text-align:center;">将做了符号扩展的字节传送到双字</td></tr> <tr><td style="text-align:center;">movswl</td> <td style="text-align:center;"></td> <td style="text-align:center;">将做了符号扩展的字传送到双字</td></tr> <tr><td style="text-align:center;">movsbq</td> <td style="text-align:center;"></td> <td style="text-align:center;">将做了符号扩展的字节传送到四字</td></tr> <tr><td style="text-align:center;">movswq</td> <td style="text-align:center;"></td> <td style="text-align:center;">将做了符号扩展的字传送到四字</td></tr> <tr><td style="text-align:center;">movslq</td> <td style="text-align:center;"></td> <td style="text-align:center;">将做了符号扩展的双字传送到四字</td></tr> <tr><td style="text-align:center;">cltq</td> <td style="text-align:center;">%rax ← 符号扩展(%eax)</td> <td style="text-align:center;">把%eax符号扩展到%rax</td></tr></tbody></table> <ol start="2"><li>入栈，出栈命令</li></ol> <p>使用push指令进行入栈</p> <p>使用pop进行出栈</p> <p>%rsp保存着栈顶元素的地址。栈向下增长，栈顶元素的地址是所有栈中元素地址中最低的。</p> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">效果</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">pushq S</td> <td style="text-align:center;">R[%rsp] ← R[%rsp] - 8; M[R[%rsp]] ← S</td> <td style="text-align:center;">将四字压入栈</td></tr> <tr><td style="text-align:center;">popq D</td> <td style="text-align:center;">D ← M[R[%rsp]];  R[%rsp] ← R[%rsp] + 8</td> <td style="text-align:center;">将四字弹出栈</td></tr></tbody></table> <p>pushq %rbq的行为等价于：</p> <div class="language- extra-class"><pre class="language-text"><code>subq  $8, %rsp   // 栈顶元素-8
movq  %rbq, (%rsp)   //  移动值
</code></pre></div><p>popq %rax的行为等价于：</p> <div class="language- extra-class"><pre class="language-text"><code>movq  (%rsp), %rax    // 取出值
addq  $8, %rsp   // 栈顶元素 +8
</code></pre></div><ol start="3"><li>算术和逻辑操作</li></ol> <p>加法指令：add，有addb，addw, addl, addq四条指令，分别是字节加法，字加法，双字加法和四字加法。</p> <p>减法指令：sub</p> <p>乘法指令：mul</p> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">效果</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">leaq S,D</td> <td style="text-align:center;">D ← &amp;S</td> <td style="text-align:center;">加载有效地址</td></tr> <tr><td style="text-align:center;">INC D</td> <td style="text-align:center;">D ← D + 1</td> <td style="text-align:center;">加1</td></tr> <tr><td style="text-align:center;">DEC D</td> <td style="text-align:center;">D ← D - 1</td> <td style="text-align:center;">减1</td></tr> <tr><td style="text-align:center;">NEG D</td> <td style="text-align:center;">D ← -D</td> <td style="text-align:center;">取负</td></tr> <tr><td style="text-align:center;">NOT D</td> <td style="text-align:center;">D ← ~D</td> <td style="text-align:center;">取补</td></tr> <tr><td style="text-align:center;">ADD S, D</td> <td style="text-align:center;">D ← D + S</td> <td style="text-align:center;">加</td></tr> <tr><td style="text-align:center;">SUB S, D</td> <td style="text-align:center;">D ← D - S</td> <td style="text-align:center;">减</td></tr> <tr><td style="text-align:center;">IMUL S, D</td> <td style="text-align:center;">D ← D * S</td> <td style="text-align:center;">乘</td></tr> <tr><td style="text-align:center;">XOR S, D</td> <td style="text-align:center;">D ← D ^ S</td> <td style="text-align:center;">异或</td></tr> <tr><td style="text-align:center;">OR S, D</td> <td style="text-align:center;">D ← D</td> <td style="text-align:center;">S</td></tr> <tr><td style="text-align:center;">AND S, D</td> <td style="text-align:center;">D ← D &amp; S</td> <td style="text-align:center;">与</td></tr> <tr><td style="text-align:center;">SAL k, D</td> <td style="text-align:center;">D ← D &lt;&lt; k</td> <td style="text-align:center;">左移</td></tr> <tr><td style="text-align:center;">SHL k, D</td> <td style="text-align:center;">D ← D &lt;&lt; k</td> <td style="text-align:center;">左移(等同于SAL)</td></tr> <tr><td style="text-align:center;">SAR k, D</td> <td style="text-align:center;">D ← D &gt;&gt; k</td> <td style="text-align:center;">算术右移</td></tr> <tr><td style="text-align:center;">SHR k, D</td> <td style="text-align:center;">D ← D &gt;&gt; k</td> <td style="text-align:center;">逻辑右移</td></tr></tbody></table> <p>其中加载有效地址leaq指令实际上是movq指令的变形。指令形式是从内存读数据到寄存器，但实际上它根本就没有引用内存。如：寄存器%rdx的值为x，leaq 7(%rdx, %rdx, 4), %rax将设置寄存器%rax的值为5x + 7.</p> <p>一元操作，INC 到 NOT，指的是已有一个操作数，既是源也是目的。这个操作数可以是一个寄存器，也可以是一个内存位置。</p> <p>二元操作，ADD 到 AND, 第一个操作数是源，第二个操作数既是源又是目的。</p> <p>移位操作，SAL 到 SHR, 第一个为移位量，第二个为要移位的数。</p> <ol start="4"><li>特殊的算术操作</li></ol> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">效果</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">imulq S</td> <td style="text-align:center;">R[%rdx]: R[%rax] ← S * R[%rax]</td> <td style="text-align:center;">有符号全乘法</td></tr> <tr><td style="text-align:center;">mulq S</td> <td style="text-align:center;">R[%rdx]: R[%rax] ← S * R[%rax]</td> <td style="text-align:center;">无符号全乘法</td></tr> <tr><td style="text-align:center;">clto</td> <td style="text-align:center;">R[%rdx] : R[%rax] ← 符号扩展(R[%rax])</td> <td style="text-align:center;">转换为八字</td></tr> <tr><td style="text-align:center;">idivq S</td> <td style="text-align:center;">R[%rdx] ← R[%rdx] : R[%rax] mod S; R[%rdx] ← R[%rdx] : R[%rax] / S</td> <td style="text-align:center;">有符号除法</td></tr> <tr><td style="text-align:center;">divq  S</td> <td style="text-align:center;">R[%rdx] ← R[%rdx] : R[%rax] mod S; R[%rdx] ← R[%rdx] : R[%rax] / S</td> <td style="text-align:center;">无符号除法</td></tr></tbody></table> <ol start="5"><li>条件码</li></ol> <p>除了整数寄存器，CPU还维护着一组单个位的条件码寄存器。</p> <p>常用条件码：</p> <p>CF: 进位标志。最近的操作使最高位产生了进位。可用来检查无符号操作的溢出。</p> <p>ZF: 零标志。最近的操作得出的结果为0.</p> <p>SF: 符号标志。最近的操作得到的结果数位负数。</p> <p>OF：溢出标志。最近的操作导致一个补码溢出。</p> <p>条件码通常不会直接读取,常用的使用方法有三种:</p> <p>可以根据条件码的某种组合将一个字节设置位0或1</p> <p>可以条件跳转到程序的某个其他的部分</p> <p>可以有条件地传送数据</p> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">同义名</th> <th style="text-align:center;">效果</th> <th style="text-align:center;">设置条件</th></tr></thead> <tbody><tr><td style="text-align:center;">sete D</td> <td style="text-align:center;">setz</td> <td style="text-align:center;">D ← ZF</td> <td style="text-align:center;">相等/零</td></tr> <tr><td style="text-align:center;">setne D</td> <td style="text-align:center;">setnz</td> <td style="text-align:center;">D ← ~ZF</td> <td style="text-align:center;">不等/非零</td></tr> <tr><td style="text-align:center;">sets D</td> <td style="text-align:center;"></td> <td style="text-align:center;">D ← SF</td> <td style="text-align:center;">负数</td></tr> <tr><td style="text-align:center;">setns D</td> <td style="text-align:center;"></td> <td style="text-align:center;">D ← ~SF</td> <td style="text-align:center;">非负数</td></tr> <tr><td style="text-align:center;">setg D</td> <td style="text-align:center;">setnle</td> <td style="text-align:center;">D ← ~(SF ^ OF) &amp; ~ZF</td> <td style="text-align:center;">大于(有符号&gt;)</td></tr> <tr><td style="text-align:center;">setge D</td> <td style="text-align:center;">setnl</td> <td style="text-align:center;">D ← ~(SF ^ OF)</td> <td style="text-align:center;">大于等于(有符号&gt;=)</td></tr> <tr><td style="text-align:center;">setl D</td> <td style="text-align:center;">setnge</td> <td style="text-align:center;">D ← SF ^ OF</td> <td style="text-align:center;">小于(有符号&lt;)</td></tr> <tr><td style="text-align:center;">setle D</td> <td style="text-align:center;">setng</td> <td style="text-align:center;">D ← (SF ^ OF)</td> <td style="text-align:center;">ZF</td></tr> <tr><td style="text-align:center;">seta D</td> <td style="text-align:center;">setnbe</td> <td style="text-align:center;">D ← ~CF &amp; ~ZF</td> <td style="text-align:center;">超过(无符号&gt;)</td></tr> <tr><td style="text-align:center;">setae D</td> <td style="text-align:center;">setnb</td> <td style="text-align:center;">D ← ~CF</td> <td style="text-align:center;">超过或相等(无符号&gt;=)</td></tr> <tr><td style="text-align:center;">setb D</td> <td style="text-align:center;">setnae</td> <td style="text-align:center;">D ← CF</td> <td style="text-align:center;">低于(无符号&lt;)</td></tr> <tr><td style="text-align:center;">setbe D</td> <td style="text-align:center;">setna</td> <td style="text-align:center;">D ← CF</td> <td style="text-align:center;">ZF</td></tr></tbody></table> <ol start="6"><li>比较和测试命令</li></ol> <p>CMP命令</p> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">效果</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">CMP S1,S2</td> <td style="text-align:center;">S2 - S1</td> <td style="text-align:center;">比较</td></tr> <tr><td style="text-align:center;">cmpb</td> <td style="text-align:center;"></td> <td style="text-align:center;">比较字节</td></tr> <tr><td style="text-align:center;">cmpw</td> <td style="text-align:center;"></td> <td style="text-align:center;">比较字</td></tr> <tr><td style="text-align:center;">cmpl</td> <td style="text-align:center;"></td> <td style="text-align:center;">比较双字</td></tr> <tr><td style="text-align:center;">cmpq</td> <td style="text-align:center;"></td> <td style="text-align:center;">比较四字</td></tr></tbody></table> <p>TEST命令</p> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">效果</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">TEST S1,S2</td> <td style="text-align:center;">S2 &amp; S1</td> <td style="text-align:center;">测试</td></tr> <tr><td style="text-align:center;">testb</td> <td style="text-align:center;"></td> <td style="text-align:center;">测试字节</td></tr> <tr><td style="text-align:center;">testw</td> <td style="text-align:center;"></td> <td style="text-align:center;">测试字</td></tr> <tr><td style="text-align:center;">testl</td> <td style="text-align:center;"></td> <td style="text-align:center;">测试双字</td></tr> <tr><td style="text-align:center;">testq</td> <td style="text-align:center;"></td> <td style="text-align:center;">测试四字</td></tr></tbody></table> <ol start="7"><li>跳转指令</li></ol> <p>常用的跳转指令jmp,无条件跳转</p> <p>movq  $0, %rax
jmp .L1
movq (%rax), %rdx
.L1:
popq %rdx</p> <p>跳过了movq命令.</p> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">同义名</th> <th style="text-align:center;">跳转条件</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">jmp Label</td> <td style="text-align:center;"></td> <td style="text-align:center;">1</td> <td style="text-align:center;">直接跳转</td></tr> <tr><td style="text-align:center;">jmp *Operand</td> <td style="text-align:center;"></td> <td style="text-align:center;">1</td> <td style="text-align:center;">间接跳转</td></tr> <tr><td style="text-align:center;">je Label</td> <td style="text-align:center;">jz</td> <td style="text-align:center;">ZF</td> <td style="text-align:center;">相等/零</td></tr> <tr><td style="text-align:center;">jne Label</td> <td style="text-align:center;">jnz</td> <td style="text-align:center;">~ZF</td> <td style="text-align:center;">不相等/非零</td></tr> <tr><td style="text-align:center;">js Label</td> <td style="text-align:center;"></td> <td style="text-align:center;">SF</td> <td style="text-align:center;">负数</td></tr> <tr><td style="text-align:center;">jns Label</td> <td style="text-align:center;"></td> <td style="text-align:center;">~SF</td> <td style="text-align:center;">非负数</td></tr> <tr><td style="text-align:center;">jg Label</td> <td style="text-align:center;">jnle</td> <td style="text-align:center;">~(SF ^ OF) &amp; ~ZF</td> <td style="text-align:center;">大于(有符号&gt;)</td></tr> <tr><td style="text-align:center;">jge Label</td> <td style="text-align:center;">jnl</td> <td style="text-align:center;">~(SF ^ OF)</td> <td style="text-align:center;">大于或等于(有符号&gt;=)</td></tr> <tr><td style="text-align:center;">jl Label</td> <td style="text-align:center;">jnge</td> <td style="text-align:center;">SF^OF</td> <td style="text-align:center;">小于(有符号&lt;)</td></tr> <tr><td style="text-align:center;">jle Label</td> <td style="text-align:center;">jng</td> <td style="text-align:center;">(SF^OF)</td> <td style="text-align:center;">ZF</td></tr> <tr><td style="text-align:center;">ja Label</td> <td style="text-align:center;">jnbe</td> <td style="text-align:center;">~CF&amp;~ZF</td> <td style="text-align:center;">超过(无符号&gt;)</td></tr> <tr><td style="text-align:center;">jae Label</td> <td style="text-align:center;">jnb</td> <td style="text-align:center;">~CF</td> <td style="text-align:center;">超过或相等(无符号&gt;=)</td></tr> <tr><td style="text-align:center;">jb Label</td> <td style="text-align:center;">jnae</td> <td style="text-align:center;">CF</td> <td style="text-align:center;">低于(无符号&lt;)</td></tr> <tr><td style="text-align:center;">jbe Label</td> <td style="text-align:center;">jna</td> <td style="text-align:center;">CF</td> <td style="text-align:center;">ZF</td></tr></tbody></table> <ol start="8"><li>提交传送指令</li></ol> <p>每条指令有两个操作数，源寄存器或内存地址S，和目的寄存器R。只有在条件满足的情况下，才会将寄存器或内存中的值复制到目的寄存器中。</p> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">同义名</th> <th style="text-align:center;">跳转条件</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">cmove S, R</td> <td style="text-align:center;">cmovz</td> <td style="text-align:center;">ZF</td> <td style="text-align:center;">相等/零</td></tr> <tr><td style="text-align:center;">cmovne S, R</td> <td style="text-align:center;">cmovnz</td> <td style="text-align:center;">~ZF</td> <td style="text-align:center;">不相等/非零</td></tr> <tr><td style="text-align:center;">cmovs S, R</td> <td style="text-align:center;"></td> <td style="text-align:center;">SF</td> <td style="text-align:center;">负数</td></tr> <tr><td style="text-align:center;">cmovns S, R</td> <td style="text-align:center;"></td> <td style="text-align:center;">~SF</td> <td style="text-align:center;">非负数</td></tr> <tr><td style="text-align:center;">cmovg S, R</td> <td style="text-align:center;">cmovnle</td> <td style="text-align:center;">~(SF ^ OF) &amp; ~ZF</td> <td style="text-align:center;">大于(有符号&gt;)</td></tr> <tr><td style="text-align:center;">cmovge S, R</td> <td style="text-align:center;">cmovnl</td> <td style="text-align:center;">~(SF ^ OF)</td> <td style="text-align:center;">大于或等于(有符号&gt;=)</td></tr> <tr><td style="text-align:center;">cmovl S, R</td> <td style="text-align:center;">cmovnge</td> <td style="text-align:center;">SF^OF</td> <td style="text-align:center;">小于(有符号&lt;)</td></tr> <tr><td style="text-align:center;">cmovle S, R</td> <td style="text-align:center;">cmovng</td> <td style="text-align:center;">(SF^OF)</td> <td style="text-align:center;">ZF</td></tr> <tr><td style="text-align:center;">cmova S, R</td> <td style="text-align:center;">cmovnbe</td> <td style="text-align:center;">~CF&amp;~ZF</td> <td style="text-align:center;">超过(无符号&gt;)</td></tr> <tr><td style="text-align:center;">cmovae S, R</td> <td style="text-align:center;">cmovnb</td> <td style="text-align:center;">~CF</td> <td style="text-align:center;">超过或相等(无符号&gt;=)</td></tr> <tr><td style="text-align:center;">cmovb S, R</td> <td style="text-align:center;">cmovnae</td> <td style="text-align:center;">CF</td> <td style="text-align:center;">低于(无符号&lt;)</td></tr> <tr><td style="text-align:center;">cmovbe S, R</td> <td style="text-align:center;">cmovna</td> <td style="text-align:center;">CF</td> <td style="text-align:center;">ZF</td></tr></tbody></table> <ol start="9"><li>循环</li></ol> <p>汇编语言中的循环常使用跳转和判断来代替。</p> <ol start="10"><li>switch语句</li></ol> <p>switch语句可以根据一个整数索引值进行多重分支。c语言为了实现switch，使用的是挑战表这种数据结果。跳转表是一个数组，表项i是一个代码段的地址，这个代码段实现当开关索引值等于i时程序应该采取的动作。汇编代码也是通过地址和跳转表实现。</p> <h3 id="过程"><a href="#过程" class="header-anchor">#</a> 过程</h3> <p>过程时软件中一种很重要的抽象。它提供了一种封装代码的方式，用一组指定的参数和一个可选的返回值实现了某种功能。</p> <ol><li>运行时栈</li></ol> <p>C语言过程调用机制的一个关键特征(大多数其他语言也是如此)在于使用了栈数据结构提供的后进先出的内存管理原则。</p> <p>x86-64的栈向低地址方向增长，而栈指针%rsp指向栈顶元素。可以用pushq和popq指令将数据存入栈中或是从栈中取出。将栈指针减小一个适当的量可以为没有指定初始值的数据在栈上分配空间。当过程需要的存储空间超出寄存器能够存放的大小时，就会在栈上分配空间。这个部分成为过程的栈帧。其通用结构如下图：</p> <ol start="2"><li>转移控制</li></ol> <p>调用过程常常需要进行程序计数器(PC)的转移。常用call和ret指令进行。</p> <table><thead><tr><th style="text-align:center;">指令</th> <th style="text-align:center;">描述</th></tr></thead> <tbody><tr><td style="text-align:center;">call Label</td> <td style="text-align:center;">过程调用</td></tr> <tr><td style="text-align:center;">call ·Operand</td> <td style="text-align:center;">过程调用</td></tr> <tr><td style="text-align:center;">ret</td> <td style="text-align:center;">从过程调用中返回</td></tr></tbody></table> <ol start="3"><li>数据传送</li></ol> <p>参数传递一般使用寄存器，使用寄存器一般传递6个参数，超过6个参数，将使用栈来传递。</p> <table><thead><tr><th style="text-align:center;">操作数大小(位)</th> <th style="text-align:center;">第一个参数</th> <th style="text-align:center;">第二个参数</th> <th style="text-align:center;">第三个参数</th> <th style="text-align:center;">第四个参数</th> <th style="text-align:center;">第五个参数</th> <th style="text-align:center;">第六个参数</th></tr></thead> <tbody><tr><td style="text-align:center;">64</td> <td style="text-align:center;">%rdi</td> <td style="text-align:center;">%rsi</td> <td style="text-align:center;">%rdx</td> <td style="text-align:center;">%rcx</td> <td style="text-align:center;">%r8</td> <td style="text-align:center;">%r9</td></tr> <tr><td style="text-align:center;">32</td> <td style="text-align:center;">%edi</td> <td style="text-align:center;">%esi</td> <td style="text-align:center;">%edx</td> <td style="text-align:center;">%ecx</td> <td style="text-align:center;">%r8d</td> <td style="text-align:center;">%r9d</td></tr> <tr><td style="text-align:center;">16</td> <td style="text-align:center;">%di</td> <td style="text-align:center;">%si</td> <td style="text-align:center;">%dx</td> <td style="text-align:center;">%cx</td> <td style="text-align:center;">%r8w</td> <td style="text-align:center;">%r9w</td></tr> <tr><td style="text-align:center;">8</td> <td style="text-align:center;">%dil</td> <td style="text-align:center;">%sil</td> <td style="text-align:center;">%dl</td> <td style="text-align:center;">%cl</td> <td style="text-align:center;">%r8b</td> <td style="text-align:center;">%r9b</td></tr></tbody></table> <ol start="4"><li>栈上的局部存储</li></ol> <p>某些局部变量必须存放在内存中。常见的情况包括：</p> <p>寄存器不足够存放所有的本地数据。</p> <p>对一个局部变量使用地址运算符'&amp;'，因此必须能够为它产生一个地址。</p> <p>某些局部变量是数组或结构，必须能够通过数组或结构引用被访问到。</p> <h3 id="数组的分配和访问"><a href="#数组的分配和访问" class="header-anchor">#</a> 数组的分配和访问</h3> <p>数组是一种将标量数据聚集成更大数据类型的方式。长分配一连串的地址。</p> <h3 id="指针运算"><a href="#指针运算" class="header-anchor">#</a> 指针运算</h3> <p>如果p是一个执行类型位T的数据的指针，p的值位x，那么表达式p + i的值为x + L * i,这里的L是数据类型T的大小。</p> <p>单操作数操作符'&amp;'和'*'可以产生指针和间接引用指针。即对于一个表示某个对象的表达式Expr，&amp;Expr是给出该对象地址的一个指针。对于一个表示地址的表达式AExpr，<em>AExpr是给出该地址的值。因此Expr和</em> &amp;Expr是等价的。数组引用A[i] 等同于表达式 * (A + i)。它计算第i个数组元素的地址，然后访问这个内存地址。</p> <h3 id="异质的数据结构"><a href="#异质的数据结构" class="header-anchor">#</a> 异质的数据结构</h3> <p>C语言提供了两种将不同类型的对象组合到一起创建数据类型的机制：结构(strcture),用关键字struct来声明，将多个对象集合到一个单位中；联合(union),用关键字union来声明，允许用几种不同的类型来引用一个对象。
类似于数组的实现。</p> <h3 id="小结"><a href="#小结" class="header-anchor">#</a> 小结</h3> <p>第三章主要讲了汇编代码和汇编的一些基础命令。同时通过c语言的一些代码来解释汇编代码。</p> <h2 id="第四章-处理器体系结构"><a href="#第四章-处理器体系结构" class="header-anchor">#</a> 第四章 处理器体系结构</h2> <h3 id="y86-64指令集体系结构"><a href="#y86-64指令集体系结构" class="header-anchor">#</a> Y86-64指令集体系结构</h3> <p>定义一个指令集体系结构，包括定义各种状态单元，指令集和它们的编码，一组编程规范和异常事件处理。</p> <p>图4.1表示程序员可见状态。表示程序可以访问和修改这些值。</p> <p>图4.2表示Y86-64的指令集。Y86-64指令基本上是x86-64指令集的子集，只包含8字节整数操作，寻址方式比较少，操作也比较少。</p> <p>x86-64有时称为&quot;复杂指令集计算机&quot;(CISC),与&quot;精简指令集计算机&quot;(RISC)相对。</p> <p>CISC和RISC的比较</p> <table><thead><tr><th style="text-align:center;">CISC</th> <th style="text-align:center;">早期的RISC</th></tr></thead> <tbody><tr><td style="text-align:center;">指令数量很多，Intel描述全套指令的文档有1200多页</td> <td style="text-align:center;">指令数量少得多，通常少于100个</td></tr> <tr><td style="text-align:center;">有些指令的延迟很长，包括将一个整块从内存的一个部分复制到另一部分的指令，以及其他一些将多个寄存器的值复制到内存或从内存复制到多个寄存器的指令</td> <td style="text-align:center;">没有较长延迟的指令，有些早期的RISC机器甚至没有整数乘法指令，要求编译器通过一系列加法来实现乘法</td></tr> <tr><td style="text-align:center;">编码是可变长度的，x86-64的指令长度可以是1-15个字节</td> <td style="text-align:center;">编码是固定长度的，通常所有的指令都编码为4个字节</td></tr> <tr><td style="text-align:center;">指令操作数的方式很多样，在x86-64中，内存操作数指令符可以有许多不同的组合，这些组合有偏移量基址和变址寄存器以及伸缩因子组成</td> <td style="text-align:center;">简单寻址方式，通常只有基址和偏移量寻址</td></tr> <tr><td style="text-align:center;">可以对内存和寄存器操作数进行算术和逻辑运算</td> <td style="text-align:center;">只能对寄存器操作数进行算术和逻辑运算。允许使用内存引用的只有load和store指令，load是从内存读到寄存器，store是从寄存器写到内存，这种方法被称为load/store体系结构</td></tr> <tr><td style="text-align:center;">对机器级程序来说实现细节是不可见的。ISA提供了程序和如何执行程序之间的清晰的抽象</td> <td style="text-align:center;">对机器程序来说实现细节是不可见的。有些RISC机器指令进制某些特殊的指令序列，而有些跳转要到下一条指令执行完了以后才会生效</td></tr> <tr><td style="text-align:center;">有条件码。</td> <td style="text-align:center;">没有条件码，对于条件检测来说，要用明确的测试指令，这些指令会将测试结构放在一个普通的寄存器</td></tr> <tr><td style="text-align:center;">栈密集的过程链接。栈被用来存取过程参数和返回地址</td> <td style="text-align:center;">寄存器密集的过程链接。寄存器被用来存取过程参数和返回地址</td></tr></tbody></table> <p>对Y86-64来说，程序员可见状态包括了状态码Stat，描述程序执行的总体状态。可能值如图4.5所示。</p></div> <footer class="page-edit" style="display:none;"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2021-07-03 23:01:53</span></div></footer> <!----> <!----> <!----></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.e5db9849.js" defer></script><script src="/assets/js/3.ed8c06e7.js" defer></script><script src="/assets/js/1.9e75a2be.js" defer></script><script src="/assets/js/29.0e91ba17.js" defer></script>
  </body>
</html>
